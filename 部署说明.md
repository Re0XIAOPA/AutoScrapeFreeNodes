# GitHub Pages部署说明

本文档详细介绍如何将免费节点抓取工具部署到GitHub Pages，并设置自动化工作流。

## 部署步骤

### 1. Fork仓库

1. 登录GitHub账号，访问[原始仓库URL]
2. 点击页面右上角的"Fork"按钮，创建一个仓库副本到你的账号下

### 2. 启用GitHub Pages

1. 进入你fork的仓库
2. 点击"Settings" > "Pages"
3. 在"Source"部分，选择"gh-pages" /(root)，点击"Save"
4. 等待几分钟，GitHub将自动部署你的网站

### 3. 配置工作流权限

1. 在仓库中，点击"Settings" > "Actions" > "General"
2. 在"Workflow permissions"部分，选择"Read and write permissions"，点击"Save"
3. 这使GitHub Actions能够提交数据回主分支

### 4. 查看部署状态

1. 在仓库中，点击"Actions"标签查看工作流运行状态
2. 第一次部署可能需要手动触发：
   - 点击"Actions"
   - 选择"部署免费节点抓取工具到GitHub Pages"
   - 点击"Run workflow"按钮

### 5. 访问你的网站

成功部署后，你可以通过以下URL访问网站：
```
https://你的用户名.github.io/仓库名
```

## 自动更新机制

本项目配置了两个自动化工作流：

1. **部署工作流** (`deploy.yml`)
   - 每4小时运行一次
   - 抓取最新节点数据
   - 生成静态网站并部署到GitHub Pages
   
2. **数据更新工作流** (`update-data.yml`)
   - 每2小时运行一次
   - 只更新数据，不重新部署网站
   - 将最新数据提交到主分支

## 自定义配置

### 修改抓取站点

编辑`config.json`文件，在`sites`数组中添加或修改网站：

```json
{
  "sites": [
    {
      "url": "https://example.com/",
      "enabled": true,
      "description": "新增节点站点"
    }
  ]
}
```

### 修改更新频率

1. 编辑`.github/workflows/deploy.yml`文件，修改`cron`表达式：
   ```yaml
   schedule:
     - cron: '0 */4 * * *'  # 每4小时运行一次
   ```

2. 编辑`.github/workflows/update-data.yml`文件，修改`cron`表达式：
   ```yaml
   schedule:
     - cron: '0 */2 * * *'  # 每2小时运行一次
   ```

## 本地开发与测试

### 运行模式说明

项目支持三种运行模式：

1. **开发模式** - 运行动态Node.js服务器
   ```bash
   npm start
   ```
   访问 http://localhost:3001，支持实时刷新数据

2. **静态生成** - 生成静态网站文件
   ```bash
   npm run generate
   ```
   生成的文件位于`dist`目录

3. **静态文件测试服务器** - 测试生成的静态文件
   ```bash
   npm run test-static
   ```
   访问 http://localhost:8080，模拟GitHub Pages环境

### 快速测试流程

为方便测试，项目提供了一键测试脚本：

- Windows: 运行 `快速测试.bat`
- Mac/Linux: 运行 `./快速测试.sh` (确保有执行权限)

这些脚本会自动执行安装依赖、生成静态网站和启动测试服务器的完整流程。

### 静态与动态模式的区别

- **动态模式**：数据存储在服务器内存/文件中，支持实时刷新
- **静态模式**：所有API返回预生成的JSON文件，不支持实时刷新

前端会自动检测当前环境并适配相应的API路径。

## 高级选项

### 使用自定义域名

1. 在仓库中编辑`CNAME`文件，添加你的域名
2. 在你的域名注册商处添加DNS记录，指向GitHub Pages

## 故障排除

### 本地测试问题

1. **404错误或API请求失败**
   - 确保先运行`npm run generate`生成静态文件
   - 确认前端配置正确识别环境
   - 使用浏览器开发工具检查网络请求

2. **数据显示为空**
   - 检查`data`目录是否有JSON文件
   - 如果没有，先运行动态服务器`npm start`抓取数据

3. **刷新按钮不起作用**
   - 静态模式下刷新按钮仅返回提示信息
   - 需要重新生成静态文件才能更新数据

### GitHub部署问题

1. **部署失败**
   - 检查Actions日志中的错误信息
   - 确保工作流有正确的权限

2. **数据未更新**
   - 检查Actions日志
   - 尝试手动触发工作流

3. **样式/脚本加载失败**
   - 检查浏览器控制台报错
   - 确认`production`环境中的API路径配置正确 