# GitHub Pages部署说明

本文档详细介绍如何将免费节点抓取工具部署到GitHub Pages，并设置自动化工作流。

## 系统要求

- **Node.js**: 18.0.0 或更高版本 (必须)
- GitHub 账户
- Git 基础知识

## 部署步骤

### 1. Fork仓库

1. 登录GitHub账号，访问[原始仓库URL]
2. 点击页面右上角的"Fork"按钮，创建一个仓库副本到你的账号下

### 2. 启用GitHub Pages

1. 进入你fork的仓库
2. 点击"Settings" > "Pages"
3. 在"Source"部分，选择"gh-pages" /(root)，点击"Save"
4. 等待几分钟，GitHub将自动部署你的网站

### 3. 配置工作流权限

1. 在仓库中，点击"Settings" > "Actions" > "General"
2. 在"Workflow permissions"部分，选择"Read and write permissions"，点击"Save"
3. 这使GitHub Actions能够提交数据回主分支

### 4. 查看部署状态

1. 在仓库中，点击"Actions"标签查看工作流运行状态
2. 第一次部署可能需要手动触发：
   - 点击"Actions"
   - 选择"部署免费节点抓取工具到GitHub Pages"
   - 点击"Run workflow"按钮

### 5. 访问你的网站

成功部署后，你可以通过以下URL访问网站：
```
https://你的用户名.github.io/仓库名
```

## 自动更新机制

本项目配置了两个自动化工作流：

1. **部署工作流** (`deploy.yml`)
   - 每天北京时间 00:30 运行一次
   - 抓取最新节点数据
   - 生成静态网站并部署到GitHub Pages
   
2. **数据更新工作流** (`update-data.yml`)
   - 每天北京时间 00:30 和 12:30 各运行一次
   - 只更新数据，不重新部署网站
   - 将最新数据提交到主分支

## 自定义配置

### 修改抓取站点

编辑`config.json`文件，在`sites`数组中添加或修改网站：

```json
{
  "sites": [
    {
      "url": "https://example.com/",
      "enabled": true,
      "description": "新增节点站点"
    }
  ]
}
```

### 修改更新频率

GitHub Actions 使用的是 UTC 时间，请注意转换时区（北京时间 = UTC+8）：

1. 编辑`.github/workflows/deploy.yml`文件，修改`cron`表达式：
   ```yaml
   schedule:
     - cron: '30 16 * * *'  # 北京时间00:30运行（16:30 UTC）
   ```

2. 编辑`.github/workflows/update-data.yml`文件，修改`cron`表达式：
   ```yaml
   schedule:
     - cron: '30 16,4 * * *'  # 北京时间00:30和12:30运行（16:30和4:30 UTC）
   ```

cron表达式格式：`分 时 日 月 星期`，例如：
- `0 */6 * * *`: 每6小时运行一次（0:00, 6:00, 12:00, 18:00 UTC）
- `0 0 * * *`: 每天UTC时间0:00运行
- `0 0 * * 1`: 每周一UTC时间0:00运行

## 本地开发与测试

### 运行模式说明

项目支持三种运行模式：

1. **开发模式** - 运行动态Node.js服务器
   ```bash
   npm start
   ```
   访问 http://localhost:3001，支持实时刷新数据

2. **静态生成** - 生成静态网站文件
   ```bash
   npm run generate
   ```
   生成的文件位于`dist`目录

3. **静态文件测试服务器** - 测试生成的静态文件
   ```bash
   npm run test-static
   ```
   访问 http://localhost:8080，模拟GitHub Pages环境

### 快速测试流程

为方便测试，项目提供了一键测试脚本：

- Windows: 运行 `快速测试.bat`
- Mac/Linux: 运行 `./快速测试.sh` (确保有执行权限)

这些脚本会自动执行安装依赖、生成静态网站和启动测试服务器的完整流程。

### 静态与动态模式的区别

- **动态模式**：数据存储在服务器内存/文件中，支持实时刷新
- **静态模式**：所有API返回预生成的JSON文件，不支持实时刷新

前端会自动检测当前环境并适配相应的API路径。

## 高级选项

### 使用自定义域名

1. 在仓库中编辑`CNAME`文件，添加你的域名
2. 在你的域名注册商处添加DNS记录，指向GitHub Pages

## 故障排除

### 权限问题

如果遇到以下错误：
```
remote: Permission to YourUsername/RepoName.git denied to github-actions[bot].
fatal: unable to access 'https://github.com/YourUsername/RepoName.git/': The requested URL returned error: 403
```

这是因为GitHub Actions没有足够的权限来推送到你的仓库。解决方法：

1. **设置工作流权限**：
   - 进入你的仓库
   - 点击 Settings > Actions > General
   - 在 "Workflow permissions" 部分，选择 "Read and write permissions"
   - 点击 Save 保存更改

2. **如果上述方法不起作用**，可以创建个人访问令牌(PAT)：
   - 访问你的GitHub设置 > Developer settings > Personal access tokens
   - 生成新的令牌，并给予repo权限
   - 在仓库中添加名为 `PAT` 的secret，值为你的访问令牌
   - 修改工作流文件，使用 `${{ secrets.PAT }}` 替换 `${{ secrets.GITHUB_TOKEN }}`

### Node.js 版本问题

如果遇到以下错误：
```
ReferenceError: ReadableStream is not defined
```

这表明你的 Node.js 版本过低，需要升级到 Node.js 18 或更高版本：

1. 访问 [https://nodejs.org/](https://nodejs.org/) 下载并安装最新 LTS 版本
2. 在 GitHub Actions 工作流程中，确保 `.github/workflows/deploy.yml` 文件中的 Node.js 版本设置为 18 或更高

### 本地测试问题

1. **404错误或API请求失败**
   - 确保先运行`npm run generate`生成静态文件
   - 确认前端配置正确识别环境
   - 使用浏览器开发工具检查网络请求

2. **数据显示为空**
   - 检查`data`目录是否有JSON文件
   - 如果没有，先运行动态服务器`npm start`抓取数据

3. **刷新按钮不起作用**
   - 静态模式下刷新按钮仅返回提示信息
   - 需要重新生成静态文件才能更新数据

### GitHub部署问题

1. **部署失败**
   - 检查Actions日志中的错误信息
   - 确保工作流有正确的权限

2. **数据未更新**
   - 检查Actions日志
   - 尝试手动触发工作流

3. **样式/脚本加载失败**
   - 检查浏览器控制台报错
   - 确认`production`环境中的API路径配置正确 